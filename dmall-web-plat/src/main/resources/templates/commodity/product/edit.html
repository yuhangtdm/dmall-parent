<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>
        商品详情
    </title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" href="./css/admin.css" media="all">
    <link rel="stylesheet" th:href="@{/css/tag.css}" href="./css/admin.css" media="all">
    <link rel="stylesheet" th:href="@{/layui/css/formSelects-v4.css}" href="./css/admin.css" media="all">
    <style>
        .size{
            font-size: 20px;
            vertical-align: middle;
        }
    </style>
</head>

<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
    <legend>商品信息维护</legend>
</fieldset>
<button type="button" class="layui-btn" style="float: right">保存</button>
<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
    <ul class="layui-tab-title">
        <li class="layui-this">基本信息</li>
        <li>扩展信息</li>
        <li>图片信息</li>
    </ul>
    <div class="layui-tab-content" style="height: 100px;">
        <form class="layui-form" id="product-form" action="">
            <div class="layui-tab-item layui-show">
                    <div class="layui-row" th:if="${productVo!=null}" >
                        <div class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">商品编码</label>
                            <div class="layui-input-inline">
                                <input type="text" name="productCode" lay-verify="required" autocomplete="off"
                                       class="layui-input" readonly >
                            </div>
                        </div>
                        <div class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">商品状态</label>
                            <div class="layui-input-inline">
                                <select loadData="normal"  name="state" dict="_product_state">
                                </select>
                            </div>
                        </div>
                        <div class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">上架时间</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input date" id="onSaleTime" name="onSaleTime">
                            </div>
                        </div>
                    </div>
                    <div class="layui-row" style="margin-top: 10px">
                        <div class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">商品名称</label>
                            <div class="layui-input-inline">
                                <input type="hidden" name="id" />
                                <input type="text" name="product.name" class="layui-input">
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4" th:if="${productVo!=null}">
                            <label class="layui-form-label">最高价</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.maxPrice"  autocomplete="off"
                                       class="layui-input" disabled="disabled" >
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4" th:if="${productVo!=null}">
                            <label class="layui-form-label">最低价</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.minPrice"  autocomplete="off"
                                       class="layui-input" disabled="disabled" >
                            </div>
                        </div>
                    </div>
                    <div class="layui-row" style="margin-top: 10px" >
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">商品副名称</label>
                            <div class="layui-input-inline">
                                <input type="text" name="subName" class="layui-input">
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4" th:if="${productVo!=null}">
                            <label class="layui-form-label">销量</label>
                            <div class="layui-input-inline">
                                <input type="text" name="saleCount" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4" th:if="${productVo!=null}">
                            <label class="layui-form-label">浏览量</label>
                            <div class="layui-input-inline">
                                <input type="text" name="viewCount" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                    </div>
                    <div class="layui-row" style="margin-top: 10px" th:if="${productVo!=null}" >
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">评论数</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.commentCount" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">评分</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.commentScore" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">好评率</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.goodRate" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                    </div>
                    <div class="layui-row" style="margin-top: 10px" th:if="${productVo!=null}" >
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">好评数</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.goodCommentCount" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">中评数</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.middleCommentCount" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">差评数</label>
                            <div class="layui-input-inline">
                                <input type="text" name="product.badCommentCount" class="layui-input" disabled="disabled">
                            </div>
                        </div>
                    </div>
                    <div class="layui-row" style="margin-top: 10px">
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">商品分类</label>
                            <div class="layui-input-block">
                                <select loadData="linkage" url="/type/tree" xm-select-search=""
                                        name="product.productType" xm-select="product.productType"
                                        linkage="true" linkageWidth="140" xm-select-radio="" >
                                </select>
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <label class="layui-form-label">品牌</label>
                            <div class="layui-input-inline">
                                <select id="brand" lay-filter="brand" loadData="normal" url="/brand/listAll"  name="product.brandId">
                                </select>
                            </div>
                        </div>
                        <div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">
                            <div class="layui-input-inline">
                                <button type="button" class="layui-btn" id="addProps"><i class="layui-icon layui-icon-add-circle-fine"></i>添加属性组</button>
                            </div>
                        </div>
                    </div>
            </div>
            <div class="layui-tab-item">内容2</div>
            <div class="layui-tab-item">内容3</div>
        </form>

    </div>
</div>
<script th:src="@{/layui/layui.js}" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script th:src="@{/js/jquery-3.3.1.min.js}" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script th:inline="javascript">
        layui.config({
            base: '/controller/'
        }).use(['element','form', 'transfer','curd','layer'], function () {
            var $=layui.$;
            var form = layui.form;
            var transfer = layui.transfer;
            var curd=layui.curd;
            var element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
            var formSelects = layui.formSelects;
            var layer= layui.layer;
            var i=0;
            var propsVoList=[[${productVo.propsVoList}]];
            transfer.initSelect();
            transfer.init([[${productVo}]],null,'product-form');
            if(propsVoList){
                for(var i=0;i<propsVoList.length;i++){
                    var propsVo=propsVoList[0];
                    var productTypeId=propsVo.productType;
                    var group=propsVo.id;
                    var propsList= propsVo.propsList;
                    var props=''
                    for(var j=0;j<propsList;i++){
                        props+=propsList[j].id+',';
                    }
                    props=props.substring(0,props.length-1);
                    var isSale=propsVo.isSale;
                    var html='';
                    if(isSale==1){
                         html='<div class="layui-row" style="margin-top: 10px">'
                            +'<div  class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                            +'<label class="layui-form-label">属性组</label> <div class="layui-input-block">'
                            + '<select loadData="normal" lay-filter="group" id='+i+' url="/props/group/listAll">'
                            +' </select></div></div>'
                            +'<div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                            +'<label class="layui-form-label">属性</label> <div class="layui-input-block">'
                            + '<select loadData="normal" value="'+props+'" xm-select-search="" id="props'+i+'" xm-select="props'+i+'" url="/props/listAll?productTypeId='+productTypeId+'">'
                            +' </select></div></div>'
                            +'<div  class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                            +'<label class="layui-form-label">销售属性</label><div class="layui-input-block">'
                            + '<input type="checkbox" name="isSale" checked lay-skin="switch" lay-text="是|否">&nbsp;&nbsp;'
                            + '<i class="layui-icon layui-icon-delete size" id="delete'+i+'" ></i>'
                            +'</div></div>'
                            + '</div>';
                    }else {
                         html='<div class="layui-row" style="margin-top: 10px">'
                            +'<div  class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                            +'<label class="layui-form-label">属性组</label> <div class="layui-input-block">'
                            + '<select loadData="normal" value="'+group+'"  lay-filter="group" id='+i+' url="/props/group/listAll?productTypeId='+productTypeId+'">'
                            +' </select></div></div>'
                            +'<div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                            +'<label class="layui-form-label">属性</label> <div class="layui-input-block">'
                            + '<select loadData="normal" value="'+props+'" xm-select-search="" id="props'+i+'" xm-select="props'+i+'" url="/props/listAll?productTypeId='+productTypeId+'&groupId'+group+'">'
                            +' </select></div></div>'
                            +'<div  class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                            +'<label class="layui-form-label">销售属性</label><div class="layui-input-block">'
                            + '<input type="checkbox" name="isSale" lay-skin="switch" lay-text="是|否">&nbsp;&nbsp;'
                            + '<i class="layui-icon layui-icon-delete size" id="delete'+i+'" ></i>'
                            +'</div></div>'
                            + '</div>';
                    }
                    $("#addProps").parents(".layui-row").after(html);
                    transfer.initSelect(i+'');
                    transfer.initSelect('props'+i);
                }

            }


            // 商品分类选择事件
            formSelects.on('product.productType', function(id, vals, val, isAdd, isDisabled){
                //id:           点击select的id
                //vals:         当前select已选中的值
                //val:          当前select点击的值
                //isAdd:        当前操作选中or取消
                //isDisabled:   当前选项是否是disabled
                var split=val.value.split("/");
                $("#brand").attr("url","/brand/listAll?productTypeId="+split[split.length-1]);
                transfer.initSelect('brand');
                $("#addProps").parents(".layui-row").nextAll().remove();
                i=0;
            });
            $("#addProps").click(function () {
                var productType=formSelects.value('product.productType');
                var productTypeId='';
                if(productType && productType[0]){
                    productTypeId=productType[0].value;
                }
                var html='<div class="layui-row" style="margin-top: 10px">'
                    +'<div  class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                    +'<label class="layui-form-label">属性组</label> <div class="layui-input-block">'
                    + '<select loadData="normal"  lay-filter="group" id='+i+' url="/props/group/listAll?productTypeId='+productTypeId+'">'
                    +' </select></div></div>'
                    +'<div  class=" layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                    +'<label class="layui-form-label">属性</label> <div class="layui-input-block">'
                    + '<select loadData="normal" xm-select-search="" id="props'+i+'" xm-select="props'+i+'" url="/props/listAll?productTypeId='+productTypeId+'">'
                    +' </select></div></div>'
                    +'<div  class="layui-col-xs6 layui-col-sm6 layui-col-md4 layui-col-lg4">'
                    +'<label class="layui-form-label">销售属性</label><div class="layui-input-block">'
                    + '<input type="checkbox" name="isSale" lay-skin="switch" lay-text="是|否">&nbsp;&nbsp;'
                    + '<i class="layui-icon layui-icon-delete size" id="delete'+i+'" ></i>'
                    +'</div></div>'
                    + '</div>'
                $(this).parents(".layui-row").after(html);
                transfer.initSelect(i+'');
                transfer.initSelect('props'+i);
                i++;
            });

            // 监听属性组
            form.on('select(group)',function (data) {
                var productType=formSelects.value('product.productType');
                var productTypeId='';
                if(productType && productType[0]){
                    productTypeId=productType[0].value;
                }
                var id=$(data.elem).attr("id");
                $("#props"+id).attr("url","/props/listAll?productTypeId="+productTypeId+"&groupId="+data.value);
                transfer.initSelect('props'+id);
            })

            $(document).on('mouseenter','.layui-icon-delete',function () {
                $(this).attr('style','color:red;cursor:pointer');
            })

            $(document).on('mouseout','.layui-icon-delete',function () {
                $(this).removeAttr('style');
            })

            $(document).on('click','.layui-icon-delete',function () {
                var sel=$(this);
                layer.confirm('确定删除该属性组以及属性?', {icon: 3, title:'提示'}, function(index){
                    layer.close(index);
                    sel.parents(".layui-row").remove();
                });
            })
        });
</script>

</body>
</html>