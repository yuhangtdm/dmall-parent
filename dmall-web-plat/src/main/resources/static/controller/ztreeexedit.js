"use strict";layui.define(function(e){function t(){var e={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},t={edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},d=function(e){var t=I.getRoot(e),o=I.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,o.showHoverDom=!0},r=function(e){},n=function(e){var t=e.treeObj,o=f.event;t.bind(o.RENAME,function(t,o,d,r){T.apply(e.callback.onRename,[t,o,d,r])}),t.bind(o.DRAG,function(t,o,d,r){T.apply(e.callback.onDrag,[o,d,r])}),t.bind(o.DRAGMOVE,function(t,o,d,r){T.apply(e.callback.onDragMove,[o,d,r])}),t.bind(o.DROP,function(t,o,d,r,n,a,i){T.apply(e.callback.onDrop,[o,d,r,n,a,i])})},a=function(e){var t=e.treeObj,o=f.event;t.unbind(o.RENAME),t.unbind(o.DRAG),t.unbind(o.DRAGMOVE),t.unbind(o.DROP)},i=function(e){var t=e.target,o=I.getSetting(e.data.treeId),d=e.relatedTarget,r="",n=null,a="",i=null,l=null;if(T.eqs(e.type,"mouseover")?(l=T.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+f.id.A}]))&&(r=T.getNodeMainDom(l).id,a="hoverOverNode"):T.eqs(e.type,"mouseout")?(l=T.getMDom(o,d,[{tagName:"a",attrName:"treeNode"+f.id.A}]))||(r="remove",a="hoverOutNode"):T.eqs(e.type,"mousedown")&&(l=T.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+f.id.A}]))&&(r=T.getNodeMainDom(l).id,a="mousedownNode"),r.length>0)switch(n=I.getNodeCache(o,r),a){case"mousedownNode":i=N.onMousedownNode;break;case"hoverOverNode":i=N.onHoverOverNode;break;case"hoverOutNode":i=N.onHoverOutNode}return{stop:!1,node:n,nodeEventType:a,nodeEventCallback:i,treeEventType:"",treeEventCallback:null}},l=function(e,t,o,d,r,n,a){o&&(o.isHover=!1,o.editNameFlag=!1)},s=function(e,t){t.cancelEditName=function(e){I.getRoot(this.setting).curEditNode&&E.cancelCurEditNode(this.setting,e||null,!0)},t.copyNode=function(t,o,d,r){if(!o)return null;var n=I.nodeIsParent(e,t);if(t&&!n&&this.setting.data.keep.leaf&&d===f.move.TYPE_INNER)return null;var a=this,i=T.clone(o);if(t||(t=null,d=f.move.TYPE_INNER),d==f.move.TYPE_INNER){var l=function(){E.addNodes(a.setting,t,-1,[i],r)};T.canAsync(this.setting,t)?E.asyncNode(this.setting,t,r,l):l()}else E.addNodes(this.setting,t.parentNode,-1,[i],r),E.moveNode(this.setting,t,i,d,!1,r);return i},t.editName=function(e){e&&e.tId&&e===I.getNodeCache(this.setting,e.tId)&&(e.parentTId&&E.expandCollapseParentNode(this.setting,e.getParentNode(),!0),E.editNode(this.setting,e))},t.moveNode=function(t,o,d,r){function n(){E.moveNode(i.setting,t,o,d,!1,r)}if(!o)return o;var a=I.nodeIsParent(e,t);if(t&&!a&&this.setting.data.keep.leaf&&d===f.move.TYPE_INNER)return null;if(t&&(o.parentTId==t.tId&&d==f.move.TYPE_INNER||h(o,this.setting).find("#"+t.tId).length>0))return null;t||(t=null);var i=this;return T.canAsync(this.setting,t)&&d===f.move.TYPE_INNER?E.asyncNode(this.setting,t,r,n):n(),o},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}},c={setSonNodeLevel:function(e,t,o){if(o){var d=I.nodeChildren(e,o);if(o.level=t?t.level+1:0,d)for(var r=0,n=d.length;r<n;r++)d[r]&&I.setSonNodeLevel(e,o,d[r])}}},u={},N={onHoverOverNode:function(e,t){var o=I.getSetting(e.data.treeId),d=I.getRoot(o);d.curHoverNode!=t&&N.onHoverOutNode(e),d.curHoverNode=t,E.addHoverDom(o,t)},onHoverOutNode:function(e,t){var o=I.getSetting(e.data.treeId),d=I.getRoot(o);d.curHoverNode&&!I.isSelectedNode(o,d.curHoverNode)&&(E.removeTreeDom(o,d.curHoverNode),d.curHoverNode=null)},onMousedownNode:function(t,d){function r(t){if(0==c.dragFlag&&Math.abs(A-t.clientX)<s.edit.drag.minMoveSize&&Math.abs(L-t.clientY)<s.edit.drag.minMoveSize)return!0;var d,r,a,i,l;if(w.css("cursor","pointer"),0==c.dragFlag){if(0==T.apply(s.callback.beforeDrag,[s.treeId,g],!0))return n(t),!0;for(d=0,r=g.length;d<r;d++)0==d&&(c.dragNodeShowBefore=[]),a=g[d],I.nodeIsParent(s,a)&&a.open?(E.expandCollapseNode(s,a,!a.open),c.dragNodeShowBefore[a.tId]=!0):c.dragNodeShowBefore[a.tId]=!1;c.dragFlag=1,u.showHoverDom=!1,T.showIfameMask(s,!0);var N=!0,v=-1;if(g.length>1){var O=g[0].parentTId?I.nodeChildren(s,g[0].getParentNode()):I.getNodes(s);for(l=[],d=0,r=O.length;d<r;d++)if(void 0!==c.dragNodeShowBefore[O[d].tId]&&(N&&v>-1&&v+1!==d&&(N=!1),l.push(O[d]),v=d),g.length===l.length){g=l;break}}for(N&&(R=g[0].getPreNode(),P=g[g.length-1].getNextNode()),m=h("<ul class='zTreeDragUL'></ul>",s),d=0,r=g.length;d<r;d++)a=g[d],a.editNameFlag=!1,E.selectNode(s,a,d>0),E.removeTreeDom(s,a),d>s.edit.drag.maxShowNodeNum-1||(i=h("<li id='"+a.tId+"_tmp'></li>",s),i.append(h(a,f.id.A,s).clone()),i.css("padding","0"),i.children("#"+a.tId+f.id.A).removeClass(f.node.CURSELECTED),m.append(i),d==s.edit.drag.maxShowNodeNum-1&&(i=h("<li id='"+a.tId+"_moretmp'><a>  ...  </a></li>",s),m.append(i)));m.attr("id",g[0].tId+f.id.UL+"_tmp"),m.addClass(s.treeObj.attr("class")),m.appendTo(w),p=h("<span class='tmpzTreeMove_arrow'></span>",s),p.attr("id","zTreeMove_arrow_tmp"),p.appendTo(w),s.treeObj.trigger(f.event.DRAG,[t,s.treeId,g])}if(1==c.dragFlag){if(b&&p.attr("id")==t.target.id&&k&&t.clientX+C.scrollLeft()+2>o("#"+k+f.id.A,b).offset().left){var x=o("#"+k+f.id.A,b);t.target=x.length>0?x.get(0):t.target}else b&&(b.removeClass(f.node.TMPTARGET_TREE),k&&o("#"+k+f.id.A,b).removeClass(f.node.TMPTARGET_NODE+"_"+f.move.TYPE_PREV).removeClass(f.node.TMPTARGET_NODE+"_"+e.move.TYPE_NEXT).removeClass(f.node.TMPTARGET_NODE+"_"+e.move.TYPE_INNER));b=null,k=null,M=!1,_=s;var j=I.getSettings();for(var z in j)j[z].treeId&&j[z].edit.enable&&j[z].treeId!=s.treeId&&(t.target.id==j[z].treeId||o(t.target).parents("#"+j[z].treeId).length>0)&&(M=!0,_=j[z]);var B=C.scrollTop(),H=C.scrollLeft(),F=_.treeObj.offset(),V=_.treeObj.get(0).scrollHeight,U=_.treeObj.get(0).scrollWidth,G=t.clientY+B-F.top,X=_.treeObj.height()+F.top-t.clientY-B,q=t.clientX+H-F.left,W=_.treeObj.width()+F.left-t.clientX-H,K=G<s.edit.drag.borderMax&&G>s.edit.drag.borderMin,$=X<s.edit.drag.borderMax&&X>s.edit.drag.borderMin,Z=q<s.edit.drag.borderMax&&q>s.edit.drag.borderMin,J=W<s.edit.drag.borderMax&&W>s.edit.drag.borderMin,Q=G>s.edit.drag.borderMin&&X>s.edit.drag.borderMin&&q>s.edit.drag.borderMin&&W>s.edit.drag.borderMin,ee=K&&_.treeObj.scrollTop()<=0,te=$&&_.treeObj.scrollTop()+_.treeObj.height()+10>=V,oe=Z&&_.treeObj.scrollLeft()<=0,de=J&&_.treeObj.scrollLeft()+_.treeObj.width()+10>=U;if(t.target&&T.isChildOrSelf(t.target,_.treeId)){for(var re=t.target;re&&re.tagName&&!T.eqs(re.tagName,"li")&&re.id!=_.treeId;)re=re.parentNode;var ne=!0;for(d=0,r=g.length;d<r;d++){if(a=g[d],re.id===a.tId){ne=!1;break}if(h(a,s).find("#"+re.id).length>0){ne=!1;break}}ne&&t.target&&T.isChildOrSelf(t.target,re.id+f.id.A)&&(b=o(re),k=re.id)}a=g[0],Q&&T.isChildOrSelf(t.target,_.treeId)&&(!b&&(t.target.id==_.treeId||ee||te||oe||de)&&(M||!M&&a.parentTId)&&(b=_.treeObj),K?_.treeObj.scrollTop(_.treeObj.scrollTop()-10):$&&_.treeObj.scrollTop(_.treeObj.scrollTop()+10),Z?_.treeObj.scrollLeft(_.treeObj.scrollLeft()-10):J&&_.treeObj.scrollLeft(_.treeObj.scrollLeft()+10),b&&b!=_.treeObj&&b.offset().left<_.treeObj.offset().left&&_.treeObj.scrollLeft(_.treeObj.scrollLeft()+b.offset().left-_.treeObj.offset().left)),m.css({top:t.clientY+B+3+"px",left:t.clientX+H+3+"px"});var ae=0,ie=0;if(b&&b.attr("id")!=_.treeId){var le=function(){b=null,k="",S=f.move.TYPE_INNER,p.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)},se=null==k?null:I.getNodeCache(_,k),ce=(t.ctrlKey||t.metaKey)&&s.edit.drag.isMove&&s.edit.drag.isCopy||!s.edit.drag.isMove&&s.edit.drag.isCopy,ue=!(!R||k!==R.tId),Ne=!(!P||k!==P.tId),ve=a.parentTId&&a.parentTId==k,ge=(ce||!Ne)&&T.apply(_.edit.drag.prev,[_.treeId,g,se],!!_.edit.drag.prev),me=(ce||!ue)&&T.apply(_.edit.drag.next,[_.treeId,g,se],!!_.edit.drag.next),pe=(ce||!ve)&&!(_.data.keep.leaf&&!I.nodeIsParent(s,se))&&T.apply(_.edit.drag.inner,[_.treeId,g,se],!!_.edit.drag.inner);if(ge||me||pe){var Te=o("#"+k+f.id.A,b),fe=se.isLastNode?null:o("#"+se.getNextNode().tId+f.id.A,b.next()),Ee=Te.offset().top,Ie=Te.offset().left,he=ge?pe?.25:me?.5:1:-1,be=me?pe?.75:ge?.5:0:-1,Re=(t.clientY+B-Ee)/Te.height();if((1==he||Re<=he&&Re>=-.2)&&ge?(ae=1-p.width(),ie=Ee-p.height()/2,S=f.move.TYPE_PREV):(0==be||Re>=be&&Re<=1.2)&&me?(ae=1-p.width(),ie=null==fe||I.nodeIsParent(s,se)&&se.open?Ee+Te.height()-p.height()/2:fe.offset().top-p.height()/2,S=f.move.TYPE_NEXT):pe?(ae=5-p.width(),ie=Ee,S=f.move.TYPE_INNER):le(),b&&(p.css({display:"block",top:ie+"px",left:Ie+ae+"px"}),Te.addClass(f.node.TMPTARGET_NODE+"_"+S),D==k&&y==S||(Y=(new Date).getTime()),se&&I.nodeIsParent(s,se)&&S==f.move.TYPE_INNER)){var Pe=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==se.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===se.tId&&(Pe=!1),Pe&&(window.zTreeMoveTimer=setTimeout(function(){S==f.move.TYPE_INNER&&se&&I.nodeIsParent(s,se)&&!se.open&&(new Date).getTime()-Y>_.edit.drag.autoOpenTime&&T.apply(_.callback.beforeDragOpen,[_.treeId,se],!0)&&(E.switchNode(_,se),_.edit.drag.autoExpandTrigger&&_.treeObj.trigger(f.event.EXPAND,[_.treeId,se]))},_.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=se.tId)}}else le()}else S=f.move.TYPE_INNER,b&&T.apply(_.edit.drag.inner,[_.treeId,g,null],!!_.edit.drag.inner)?b.addClass(f.node.TMPTARGET_TREE):b=null,p.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);D=k,y=S,s.treeObj.trigger(f.event.DRAGMOVE,[t,s.treeId,g])}return!1}function n(t){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),D=null,y=null,C.unbind("mousemove",r),C.unbind("mouseup",n),C.unbind("selectstart",a),w.css("cursor",""),b&&(b.removeClass(f.node.TMPTARGET_TREE),k&&o("#"+k+f.id.A,b).removeClass(f.node.TMPTARGET_NODE+"_"+f.move.TYPE_PREV).removeClass(f.node.TMPTARGET_NODE+"_"+e.move.TYPE_NEXT).removeClass(f.node.TMPTARGET_NODE+"_"+e.move.TYPE_INNER)),T.showIfameMask(s,!1),u.showHoverDom=!0,0!=c.dragFlag){c.dragFlag=0;var d,i,l;for(d=0,i=g.length;d<i;d++)l=g[d],I.nodeIsParent(s,l)&&c.dragNodeShowBefore[l.tId]&&!l.open&&(E.expandCollapseNode(s,l,!l.open),delete c.dragNodeShowBefore[l.tId]);m&&m.remove(),p&&p.remove();var N=(t.ctrlKey||t.metaKey)&&s.edit.drag.isMove&&s.edit.drag.isCopy||!s.edit.drag.isMove&&s.edit.drag.isCopy;if(!N&&b&&k&&g[0].parentTId&&k==g[0].parentTId&&S==f.move.TYPE_INNER&&(b=null),b){var v=function(){if(M){if(!N)for(var e=0,o=g.length;e<o;e++)E.removeNode(s,g[e]);S==f.move.TYPE_INNER?E.addNodes(_,R,-1,P):E.addNodes(_,R.getParentNode(),S==f.move.TYPE_PREV?R.getIndex():R.getIndex()+1,P)}else if(N&&S==f.move.TYPE_INNER)E.addNodes(_,R,-1,P);else if(N)E.addNodes(_,R.getParentNode(),S==f.move.TYPE_PREV?R.getIndex():R.getIndex()+1,P);else if(S!=f.move.TYPE_NEXT)for(e=0,o=P.length;e<o;e++)E.moveNode(_,R,P[e],S,!1);else for(e=-1,o=P.length-1;e<o;o--)E.moveNode(_,R,P[o],S,!1);E.selectNodes(_,P);var d=h(P[0],s).get(0);E.scrollIntoView(s,d),s.treeObj.trigger(f.event.DROP,[t,_.treeId,P,R,S,N])},R=null==k?null:I.getNodeCache(_,k);if(0==T.apply(s.callback.beforeDrop,[_.treeId,g,R,S,N],!0))return void E.selectNodes(O,g);var P=N?T.clone(g):g;S==f.move.TYPE_INNER&&T.canAsync(_,R)?E.asyncNode(_,R,!1,v):v()}else E.selectNodes(O,g),s.treeObj.trigger(f.event.DROP,[t,s.treeId,g,null,null,null])}}function a(){return!1}var i,l,s=I.getSetting(t.data.treeId),c=I.getRoot(s),u=I.getRoots();if(2==t.button||!s.edit.enable||!s.edit.drag.isCopy&&!s.edit.drag.isMove)return!0;var N=t.target,v=I.getRoot(s).curSelectedList,g=[];if(I.isSelectedNode(s,d))for(i=0,l=v.length;i<l;i++){if(v[i].editNameFlag&&T.eqs(N.tagName,"input")&&null!==N.getAttribute("treeNode"+f.id.INPUT))return!0;if(g.push(v[i]),g[0].parentTId!==v[i].parentTId){g=[d];break}}else g=[d];E.editNodeBlur=!0,E.cancelCurEditNode(s);var m,p,b,R,P,C=o(s.treeObj.get(0).ownerDocument),w=o(s.treeObj.get(0).ownerDocument.body),M=!1,_=s,O=s,D=null,y=null,k=null,S=f.move.TYPE_INNER,A=t.clientX,L=t.clientY,Y=(new Date).getTime();return T.uCanDo(s)&&C.bind("mousemove",r),C.bind("mouseup",n),C.bind("selectstart",a),!0}},v={getAbs:function(e){var t=e.getBoundingClientRect(),o=document.body.scrollTop+document.documentElement.scrollTop,d=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+d,t.top+o]},inputFocus:function(e){e.get(0)&&(e.focus(),T.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}},showIfameMask:function(e,t){for(var o=I.getRoot(e);o.dragMaskList.length>0;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(t)for(var d=h("iframe",e),r=0,n=d.length;r<n;r++){var a=d.get(r),i=T.getAbs(a),l=h("<div id='zTreeMask_"+r+"' class='zTreeMask' style='top:"+i[1]+"px; left:"+i[0]+"px; width:"+a.offsetWidth+"px; height:"+a.offsetHeight+"px;'></div>",e);l.appendTo(h("body",e)),o.dragMaskList.push(l)}}},g={addEditBtn:function(e,t){if(!(t.editNameFlag||h(t,f.id.EDIT,e).length>0)&&T.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var o=h(t,f.id.A,e),d="<span class='"+f.className.BUTTON+" edit' id='"+t.tId+f.id.EDIT+"' title='"+T.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+f.id.EDIT+" style='display:none;'></span>";o.append(d),h(t,f.id.EDIT,e).bind("click",function(){return!(!T.uCanDo(e)||0==T.apply(e.callback.beforeEditName,[e.treeId,t],!0))&&(E.editNode(e,t),!1)}).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||h(t,f.id.REMOVE,e).length>0)&&T.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var o=h(t,f.id.A,e),d="<span class='"+f.className.BUTTON+" remove' id='"+t.tId+f.id.REMOVE+"' title='"+T.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+f.id.REMOVE+" style='display:none;'></span>";o.append(d),h(t,f.id.REMOVE,e).bind("click",function(){return!(!T.uCanDo(e)||0==T.apply(e.callback.beforeRemove,[e.treeId,t],!0))&&(E.removeNode(e,t),e.treeObj.trigger(f.event.REMOVE,[e.treeId,t]),!1)}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){I.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(E.addEditBtn(e,t),E.addRemoveBtn(e,t)),T.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,o){var d=I.getRoot(e),r=d.curEditNode;if(r){var n=d.curEditInput,a=t||(o?I.nodeName(e,r):n.val());if(!1===T.apply(e.callback.beforeRename,[e.treeId,r,a,o],!0))return!1;I.nodeName(e,r,a);h(r,f.id.A,e).removeClass(f.node.CURSELECTED_EDIT),n.unbind(),E.setNodeName(e,r),r.editNameFlag=!1,d.curEditNode=null,d.curEditInput=null,E.selectNode(e,r,!1),e.treeObj.trigger(f.event.RENAME,[e.treeId,r,o])}return d.noSelection=!0,!0},editNode:function(e,t){var o=I.getRoot(e);if(E.editNodeBlur=!1,I.isSelectedNode(e,t)&&o.curEditNode==t&&t.editNameFlag)return void setTimeout(function(){T.inputFocus(o.curEditInput)},0);t.editNameFlag=!0,E.removeTreeDom(e,t),E.cancelCurEditNode(e),E.selectNode(e,t,!1),h(t,f.id.SPAN,e).html("<input type=text class='rename' id='"+t.tId+f.id.INPUT+"' treeNode"+f.id.INPUT+" >");var d=h(t,f.id.INPUT,e);d.attr("value",I.nodeName(e,t)),e.edit.editNameSelectAll?T.inputSelect(d):T.inputFocus(d),d.bind("blur",function(t){E.editNodeBlur||E.cancelCurEditNode(e)}).bind("keydown",function(t){"13"==t.keyCode?(E.editNodeBlur=!0,E.cancelCurEditNode(e)):"27"==t.keyCode&&E.cancelCurEditNode(e,null,!0)}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),h(t,f.id.A,e).addClass(f.node.CURSELECTED_EDIT),o.curEditInput=d,o.noSelection=!1,o.curEditNode=t},moveNode:function(e,t,o,d,r,n){var a=I.getRoot(e);if(t!=o&&(!e.data.keep.leaf||!t||I.nodeIsParent(e,t)||d!=f.move.TYPE_INNER)){var i=o.parentTId?o.getParentNode():a,l=null===t||t==a;l&&null===t&&(t=a),l&&(d=f.move.TYPE_INNER);var s=t.parentTId?t.getParentNode():a;d!=f.move.TYPE_PREV&&d!=f.move.TYPE_NEXT&&(d=f.move.TYPE_INNER),d==f.move.TYPE_INNER&&(l?o.parentTId=null:(I.nodeIsParent(e,t)||(I.nodeIsParent(e,t,!0),t.open=!!t.open,E.setNodeLineIcos(e,t)),o.parentTId=t.tId));var c,u;if(l)c=e.treeObj,u=c;else{if(n||d!=f.move.TYPE_INNER?n||E.expandCollapseNode(e,t.getParentNode(),!0,!1):E.expandCollapseNode(e,t,!0,!1),c=h(t,e),u=h(t,f.id.UL,e),c.get(0)&&!u.get(0)){var N=[];E.makeUlHtml(e,t,N,""),c.append(N.join(""))}u=h(t,f.id.UL,e)}var v=h(o,e);v.get(0)?c.get(0)||v.remove():v=E.appendNodes(e,o.level,[o],null,-1,!1,!0).join(""),u.get(0)&&d==f.move.TYPE_INNER?u.append(v):c.get(0)&&d==f.move.TYPE_PREV?c.before(v):c.get(0)&&d==f.move.TYPE_NEXT&&c.after(v);var g,m,p=-1,T=0,b=null,R=null,P=o.level,C=I.nodeChildren(e,i),w=I.nodeChildren(e,s),M=I.nodeChildren(e,t);if(o.isFirstNode)p=0,C.length>1&&(b=C[1],b.isFirstNode=!0);else if(o.isLastNode)p=C.length-1,b=C[p-1],b.isLastNode=!0;else for(g=0,m=C.length;g<m;g++)if(C[g].tId==o.tId){p=g;break}if(p>=0&&C.splice(p,1),d!=f.move.TYPE_INNER)for(g=0,m=w.length;g<m;g++)w[g].tId==t.tId&&(T=g);if(d==f.move.TYPE_INNER?(M||(M=I.nodeChildren(e,t,[])),M.length>0&&(R=M[M.length-1],R.isLastNode=!1),M.splice(M.length,0,o),o.isLastNode=!0,o.isFirstNode=1==M.length):t.isFirstNode&&d==f.move.TYPE_PREV?(w.splice(T,0,o),R=t,R.isFirstNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!0,o.isLastNode=!1):t.isLastNode&&d==f.move.TYPE_NEXT?(w.splice(T+1,0,o),R=t,R.isLastNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!0):(d==f.move.TYPE_PREV?w.splice(T,0,o):w.splice(T+1,0,o),o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!1),I.fixPIdKeyValue(e,o),I.setSonNodeLevel(e,o.getParentNode(),o),E.setNodeLineIcos(e,o),E.repairNodeLevelClass(e,o,P),!e.data.keep.parent&&C.length<1){I.nodeIsParent(e,i,!1),i.open=!1;var _=h(i,f.id.UL,e),O=h(i,f.id.SWITCH,e),D=h(i,f.id.ICON,e);E.replaceSwitchClass(i,O,f.folder.DOCU),E.replaceIcoClass(i,D,f.folder.DOCU),_.css("display","none")}else b&&E.setNodeLineIcos(e,b);R&&E.setNodeLineIcos(e,R),e.check&&e.check.enable&&E.repairChkClass&&(E.repairChkClass(e,i),E.repairParentChkClassWithSelf(e,i),i!=o.parent&&E.repairParentChkClassWithSelf(e,o)),n||E.expandCollapseParentNode(e,o.getParentNode(),!0,r)}},removeEditBtn:function(e,t){h(t,f.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){h(t,f.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,E.removeEditBtn(e,t),E.removeRemoveBtn(e,t),T.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,o){if(o!==t.level){var d=h(t,e),r=h(t,f.id.A,e),n=h(t,f.id.UL,e),a=f.className.LEVEL+o,i=f.className.LEVEL+t.level;d.removeClass(a),d.addClass(i),r.removeClass(a),r.addClass(i),n.removeClass(a),n.addClass(i)}},selectNodes:function(e,t){for(var o=0,d=t.length;o<d;o++)E.selectNode(e,t[o],o>0)}},m={tools:v,view:g,event:u,data:c};o.extend(!0,o.fn.zTree.consts,e),o.extend(!0,o.fn.zTree._z,m);var p=o.fn.zTree,T=p._z.tools,f=p.consts,E=p._z.view,I=p._z.data,h=(p._z.event,T.$);I.exSetting(t),I.addInitBind(n),I.addInitUnBind(a),I.addInitCache(r),I.addInitNode(l),I.addInitProxy(i),I.addInitRoot(d),I.addZTreeTools(s);var b=E.cancelPreSelectedNode;E.cancelPreSelectedNode=function(e,t){for(var o=I.getRoot(e).curSelectedList,d=0,r=o.length;d<r&&(t&&t!==o[d]||(E.removeTreeDom(e,o[d]),!t));d++);b&&b.apply(E,arguments)};var R=E.createNodes;E.createNodes=function(e,t,o,d,r){R&&R.apply(E,arguments),o&&E.repairParentChkClassWithSelf&&E.repairParentChkClassWithSelf(e,d)};var P=E.makeNodeUrl;E.makeNodeUrl=function(e,t){return e.edit.enable?null:P.apply(E,arguments)};var C=E.removeNode;E.removeNode=function(e,t){var o=I.getRoot(e);o.curEditNode===t&&(o.curEditNode=null),C&&C.apply(E,arguments)};var w=E.selectNode;E.selectNode=function(e,t,o){var d=I.getRoot(e);return(!I.isSelectedNode(e,t)||d.curEditNode!=t||!t.editNameFlag)&&(w&&w.apply(E,arguments),E.addHoverDom(e,t),!0)};var M=T.uCanDo;T.uCanDo=function(e,t){var o=I.getRoot(e);return!(!t||!(T.eqs(t.type,"mouseover")||T.eqs(t.type,"mouseout")||T.eqs(t.type,"mousedown")||T.eqs(t.type,"mouseup")))||(o.curEditNode&&(E.editNodeBlur=!1,o.curEditInput.focus()),!o.curEditNode&&(!M||M.apply(E,arguments)))}}var o=layui.$;e("ztreeexedit",new t)});